(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{446:function(t,a,s){"use strict";s.r(a);var n=s(44),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"初识-webpack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初识-webpack"}},[t._v("#")]),t._v(" 初识 webpack")]),t._v(" "),s("p",[t._v("这一节介绍一下前端大家庭中的重量级成员——"),s("strong",[t._v("webpack")])]),t._v(" "),s("p",[t._v("webpack 是一款打包模块化 JavaScript 的工具，专注构建模块化项目。在 webpack 里一切文件皆模块.")]),t._v(" "),s("p",[t._v("上一张官网截图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/20210208-155704@2x.png",alt:"企业微信20210208-155704@2x"}})]),t._v(" "),s("p",[t._v("webpack 可以将任何类型文件打包成 css, js 和图片，供浏览器解析。")]),t._v(" "),s("p",[t._v("开始接触 webpack 应该是在 react 或 vue 的脚手架中。当运行 "),s("code",[t._v("npm run build")]),t._v(" 时，就是 webpack 在解析和打包源文件。")]),t._v(" "),s("p",[t._v("那么 webpack 是如何打包的？具体流程是什么？")]),t._v(" "),s("p",[t._v("下面我们一步步探索。")]),t._v(" "),s("h3",{attrs:{id:"版本介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#版本介绍"}},[t._v("#")]),t._v(" 版本介绍")]),t._v(" "),s("p",[t._v("写这篇笔记时，webpack5 已经发布，所以后面代码中用到的包版本都是基于最新的 webpack5。")]),t._v(" "),s("p",[t._v("webpack4 升级到 webpack5 的指南在 "),s("RouterLink",{attrs:{to:"/webpack/webpack5升级.html"}},[t._v("这里")])],1),t._v(" "),s("h3",{attrs:{id:"核心概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心概念"}},[t._v("#")]),t._v(" 核心概念")]),t._v(" "),s("p",[t._v("4 个核心概念：")]),t._v(" "),s("ol",[s("li",[t._v("入口(entry)")]),t._v(" "),s("li",[t._v("输出(output)")]),t._v(" "),s("li",[t._v("loader")]),t._v(" "),s("li",[t._v("插件(plugins)")])]),t._v(" "),s("h4",{attrs:{id:"入口-entry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#入口-entry"}},[t._v("#")]),t._v(" 入口(entry)")]),t._v(" "),s("p",[t._v("从哪个文件开始构建，直接写相对路径字符串。默认值为 "),s("code",[t._v("./src")])]),t._v(" "),s("p",[t._v("分为单入口和多入口：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 单入口")]),t._v("\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  enrty"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./***"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 多入口")]),t._v("\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  enrty"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    main"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./***"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    other"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./***"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"输出-output"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#输出-output"}},[t._v("#")]),t._v(" 输出(output)")]),t._v(" "),s("p",[t._v("在哪里输出创建的 bundles，以及如何命名。")]),t._v(" "),s("p",[t._v("默认值为 "),s("code",[t._v("./dist")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  output"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dist"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出路径")]),t._v("\n    filename"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack.bundle.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出文件名")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("code",[t._v("output.path")]),t._v(" 属性必须是绝对路径，所以需要用 path 模块解析。")]),t._v(" "),s("p",[s("code",[t._v("output.filename")]),t._v(" 可以用占位符命名，方式如下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 静态名称")]),t._v("\nfilename"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bundle.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用入口名称")]),t._v("\nfilename"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[name].bundle.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用内部 chunk id")]),t._v("\nfilename"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[id].bundle.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用唯一的 hash")]),t._v("\nfilename"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[name].[hash].bundle.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用基于每个 chunk 内容的 hash")]),t._v("\nfilename"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[chunkhash].bundle.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loader"}},[t._v("#")]),t._v(" loader")]),t._v(" "),s("p",[t._v("webpack 自身只理解 JavaScrip，loader 让 webpack 能够去处理非 JavaScript 文件。")]),t._v(" "),s("p",[t._v("loader 配置有两个属性：")]),t._v(" "),s("ul",[s("li",[t._v("test：文件匹配规则，正则表达式。")]),t._v(" "),s("li",[t._v("use：使用哪个 loader。")])]),t._v(" "),s("p",[t._v("webpack.config.js")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rules"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        test"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.txt$")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        use"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"raw-loader"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        test"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.css$")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        use"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" loader"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"style-loader"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" loader"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"css-loader"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这个配置告诉 webpack 解析器：当 require() 或 import 一个 "),s("code",[t._v("*.txt")]),t._v(" 的文件时，先使用 raw-loader 转换一下。")]),t._v(" "),s("p",[s("strong",[t._v("常用 loader")])]),t._v(" "),s("ol",[s("li",[s("code",[t._v("file-loader")]),t._v("：解析资源文件，输出到一个文件夹。")]),t._v(" "),s("li",[s("code",[t._v("url-loader")]),t._v("：和 file-loader 类似，但只解析小文件，转换成 base64 注入代码中。")]),t._v(" "),s("li",[s("code",[t._v("babel-loader")]),t._v("：把 ES6 转换成 ES5")]),t._v(" "),s("li",[s("code",[t._v("css-loader")]),t._v("：加载 CSS 模块")]),t._v(" "),s("li",[s("code",[t._v("style-loader")]),t._v("：将所有 CSS 代码生成 style 样式，放到 head 标签里。")]),t._v(" "),s("li",[s("code",[t._v("eslint-loader")]),t._v("：通过 ESLint 检查 JavaScript 代码")]),t._v(" "),s("li",[s("code",[t._v("ts-loader")]),t._v("： 将 TypeScript 转换成 JavaScript")]),t._v(" "),s("li",[s("code",[t._v("vue-loader")]),t._v("：加载 Vue.js 单文件组件")])]),t._v(" "),s("h4",{attrs:{id:"插件-plugins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插件-plugins"}},[t._v("#")]),t._v(" 插件(plugins)")]),t._v(" "),s("p",[t._v("plugins 用于以各种方式自定义 webpack 构建流程，在构建流程中加入自己的逻辑。")]),t._v(" "),s("p",[t._v("插件分类：")]),t._v(" "),s("ul",[s("li",[t._v("内置插件：webpack.[plugin-name]")]),t._v(" "),s("li",[t._v("第三方插件：需要导入使用")])]),t._v(" "),s("p",[t._v("常用的插件:")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("html-webpack-plugin")]),t._v("：创建 HTML 文件")]),t._v(" "),s("li",[s("code",[t._v("commons-chunk-plugin")]),t._v("：提取公共代码")]),t._v(" "),s("li",[s("code",[t._v("clean-webpack-plugin")]),t._v("：删除打包文件")]),t._v(" "),s("li",[s("code",[t._v("define-plugin")]),t._v("：定义环境变量")]),t._v(" "),s("li",[s("code",[t._v("mini-css-extract-plugin")]),t._v("：将 css 提取为独立文件")]),t._v(" "),s("li",[s("code",[t._v("ignore-plugin")]),t._v("：忽略部分文件")])]),t._v(" "),s("h3",{attrs:{id:"其他资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他资源"}},[t._v("#")]),t._v(" 其他资源")]),t._v(" "),s("ol",[s("li",[t._v("这篇面试总结的很好："),s("a",{attrs:{href:"https://www.jianshu.com/p/216ed82a3e49",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("webpack 原理和 loader/plugin 实现："),s("a",{attrs:{href:"https://juejin.cn/post/6844904146827476999",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);