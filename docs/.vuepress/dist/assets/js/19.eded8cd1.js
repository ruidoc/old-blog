(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{378:function(t,a,s){"use strict";s.r(a);var v=s(44),e=Object(v.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"误操作撤回"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#误操作撤回"}},[t._v("#")]),t._v(" 误操作撤回")]),t._v(" "),s("p",[t._v("开发中经常会遇到一种情况，git 提交之后，发现修改错误，要恢复到提交前的状态，怎么办？")]),t._v(" "),s("p",[t._v("不要慌，"),s("code",[t._v("git reset")]),t._v(" 帮你解决。")]),t._v(" "),s("p",[t._v("因为每一次提交都会产生一个 commit，根据 commit 可以恢复到之前的任何一个版本。")]),t._v(" "),s("h3",{attrs:{id:"恢复命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#恢复命令"}},[t._v("#")]),t._v(" 恢复命令")]),t._v(" "),s("p",[t._v("如果刚发现提交错误，直接恢复上一步就行：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" reset --soft HEAD^\n")])])]),s("p",[t._v("这样就能撤回提交，并且还原工作区代码。")]),t._v(" "),s("p",[t._v("HEAD^ 的意思是上一个版本，还可以这样写：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("HEAD^")]),t._v("：回到上一个版本")]),t._v(" "),s("li",[s("strong",[t._v("HEAD~n")]),t._v("：回到前 n 个版本")]),t._v(" "),s("li",[s("strong",[t._v("<commitId>")]),t._v("：回到某次提交")])]),t._v(" "),s("p",[t._v("如果需要恢复到之前的某个 commit，首先通过 "),s("code",[t._v("git log")]),t._v(" 命令查看提交记录，可以看到这些内容：")]),t._v(" "),s("ul",[s("li",[t._v("commitId")]),t._v(" "),s("li",[t._v("提交人")]),t._v(" "),s("li",[t._v("提交时间")]),t._v(" "),s("li",[t._v("提交时书写的描述")])]),t._v(" "),s("p",[t._v("书写描述可以帮助我们找到正确的 commitId。")]),t._v(" "),s("p",[t._v("commitId 是一个又长又臭的 hash 值，它是这样的：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("cc7b5be253b511f508e52c5d770ec7b9c4005f3c\n")])])]),s("p",[t._v("使用它不需要全部复制，取前 "),s("code",[t._v("7")]),t._v(" 位就可以。比如要恢复到上面这个 commit，可以这样用：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" reset --hard cc7b5be\n")])])]),s("h3",{attrs:{id:"三个参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三个参数"}},[t._v("#")]),t._v(" 三个参数")]),t._v(" "),s("p",[t._v("上面只说了如何恢复到某次提交，事实上在执行 reset 之前，还要考虑两种情况：")]),t._v(" "),s("ol",[s("li",[t._v("工作区有代码（未执行 add）")]),t._v(" "),s("li",[t._v("暂存区有代码（未执行 commit）")])]),t._v(" "),s("p",[t._v("三个参数的作用，就是决定在撤销之后是否保留工作区和暂存区的代码。")]),t._v(" "),s("h4",{attrs:{id:"hard"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hard"}},[t._v("#")]),t._v(" --hard")]),t._v(" "),s("p",[t._v("撤销 commit，撤销 add，删除工作区改动代码，")]),t._v(" "),s("p",[t._v("这个参数慎用，会直接恢复到某次的 commit 状态，同时删除工作区和暂存区的代码。")]),t._v(" "),s("h4",{attrs:{id:"mixed"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mixed"}},[t._v("#")]),t._v(" --mixed")]),t._v(" "),s("p",[t._v("默认参数。撤销 commit，撤销 add，还原工作区改动代码，")]),t._v(" "),s("h4",{attrs:{id:"soft"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#soft"}},[t._v("#")]),t._v(" --soft")]),t._v(" "),s("p",[t._v("撤销 commit，不撤销 add，还原工作区改动代码。")]),t._v(" "),s("h3",{attrs:{id:"撤销-reset"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#撤销-reset"}},[t._v("#")]),t._v(" 撤销 reset？")]),t._v(" "),s("p",[t._v("在执行 reset 过程中，可能因为操作失误，恢复到了更早的一个 commit。")]),t._v(" "),s("p",[t._v("什么意思呢？比如有 4 个commit "),s("code",[t._v("a，b，c，d")]),t._v("，按照时间从早到晚的顺序是：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" d\n")])])]),s("p",[t._v("当前所在的 commit 是 d，我想恢复到 c。")]),t._v(" "),s("p",[t._v("正确操作的话，恢复到 c 后的 commit 记录是这样的：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" c\n")])])]),s("p",[t._v("但是我操作失误，直接恢复到了 b，此时的记录成了这样：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b\n")])])]),s("p",[t._v("因为恢复到了更早的 b，"),s("strong",[t._v("此时 commit 记录已经没有了 c")]),t._v("，那我想回到 c，应该怎么办？")]),t._v(" "),s("h4",{attrs:{id:"git-reflog"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#git-reflog"}},[t._v("#")]),t._v(" git reflog")]),t._v(" "),s("p",[t._v("上面的情况，用 "),s("code",[t._v("git reflog")]),t._v(" 解决。")]),t._v(" "),s("p",[t._v("git reflog 可以查看近期的操作记录。尽管 "),s("code",[t._v("git log")]),t._v(" 查不到 c，但是 c 存在过，是有记录的，所以 git reflog 能查到 c 的 commitId。")]),t._v(" "),s("p",[t._v("找到 commitid，再通过 git reset，就能恢复到 c。")]),t._v(" "),s("p",[t._v("因此，git reflog 被称为万能后悔药。")])])}),[],!1,null,null,null);a.default=e.exports}}]);