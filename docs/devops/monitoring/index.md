# 前端监控

前端监控一般包括三方面：

- 异常监控（js 报错，接口报错）
- 性能监控（FP，FCP，FMP）
- 行为数据监控（PV，UV，页面停留时长）

下面分开介绍一下具体实现：

### 异常监控

异常监控，首先是接口异常监控。对于前端来说，代码侵入性最小的就是在 axios 全局监听 http 状态码。

普通服务器错误，可以在响应拦截器里判断 `!error.response || error.response.status >= 500`，符合这个条件，就可以捕获并记录错误信息。

错误信息应该至少包含以下方面：

- 错误码
- 错误信息
- 接口 URL
- 请求 Method

除了接口异常监控，还有前端 js 代码异常监控。

有两种方式：

```js
// js错误捕获
window.addEventListene('error', error => {
  // error.TypeError
  // error.ReferenceError
})

// promise错误捕获
window.addEventListene('unhandlerejection', error => {
  // 监控错误
})
```

当捕获到异常之后，接下来我们要做两件事：`报警` 和 `记录`

报警就是接入钉钉或企业微信的机器人，收到错误信息之后推送，以便提醒和帮助后端同学定位排查错误接口。

而记录，第一步就是要将错误信息记录下来。后面最好的方案是将这些错误接入 bug 系统，标记待处理，然后后端同学修复完成后再标记已处理，避免错误忽视或者遗落。

### 性能监控

### 行为数据监控

行为数据监控，也就是对用户的页面切换，退出登录，关闭网页，点击等信息的全面采集。

具体采集什么数据，我的设计是包含以下字段：

- user_id：用户 ID
- user_name：用户名称
- route：页面地址
- platform：平台，如 pc，h5
- env：环境，如 test，dev, pro
- version：前端每次更新的版本
- created_at：操作时间
- updated_at：更新时间

这是基于**页面切换**的基础操作信息采集，可以分析出某个时间段内，用户操作了什么页面，哪个平台，什么环境，等等基础的行为分析。

但是这里还缺一个重要数据：用户页面停留时间。

页面停留时间怎么算合理？
